<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nearby Places List</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Nearby Places</h1>
    <ul id="places-list"></ul>
    <div id="location-details"></div>
    
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAXILlpWx0kAcGYMB6VeRbDSzyRw2Xsg9g&libraries=places&callback=initMap"></script>

    <script>
        let placesService;
        let map;
        let dataset = [];
        let totalFetchedPlaces = 0;
        const riyadhLocations = [
    // Central Riyadh
    { lat: 24.7139, lng: 46.6739 },  // Al Murabba
    { lat: 24.7010, lng: 46.6790 },  // King Abdullah Financial District
    { lat: 24.6944, lng: 46.6777 },  // Al Olaya
    { lat: 24.6885, lng: 46.7101 },  // Al Malaz
    { lat: 24.6957, lng: 46.7178 },  // King Abdulaziz Historical Center
    { lat: 24.6888, lng: 46.6753 },  // Al Batha
    
    // Northern Riyadh
    { lat: 24.8528, lng: 46.7174 },  // Al Sahafa
    { lat: 24.8670, lng: 46.6340 },  // Al Malqa
    { lat: 24.9069, lng: 46.5882 },  // Al Narjis
    { lat: 24.9359, lng: 46.6762 },  // Al Munsiyah
    { lat: 24.8760, lng: 46.6940 },  // Hittin
    { lat: 24.8356, lng: 46.6548 },  // Al Aqiq
    { lat: 24.8910, lng: 46.6160 },  // Al Yasmin
    
    // Southern Riyadh
    { lat: 24.6204, lng: 46.7739 },  // Al Aziziyah
    { lat: 24.6026, lng: 46.7384 },  // Al Shifa
    { lat: 24.5902, lng: 46.7024 },  // Al Suwaidi
    { lat: 24.5704, lng: 46.7247 },  // Al Manfuhah
    { lat: 24.5750, lng: 46.7462 },  // Al Misfalah
    { lat: 24.5581, lng: 46.7557 },  // Al Dirab
    
    // Eastern Riyadh
    { lat: 24.7555, lng: 46.8450 },  // Al Nahda
    { lat: 24.7699, lng: 46.8647 },  // Al Khaleej
    { lat: 24.7915, lng: 46.8354 },  // Al Hamra
    { lat: 24.7798, lng: 46.8403 },  // Al Rawdah
    { lat: 24.7573, lng: 46.8224 },  // Granada
    { lat: 24.7717, lng: 46.8589 },  // Al Qadisiyah
    { lat: 24.7891, lng: 46.8930 },  // Al Rabwah
    
    // Western Riyadh
    { lat: 24.7104, lng: 46.5495 },  // Al Diriyah
    { lat: 24.6872, lng: 46.5795 },  // Al Uraija
    { lat: 24.6621, lng: 46.5923 },  // Al Qirawan
    { lat: 24.6585, lng: 46.5408 },  // Al Shubra
    { lat: 24.6756, lng: 46.6149 },  // Laban
    { lat: 24.6801, lng: 46.5623 },  // Al Rayyan
    
    // Outskirts of Riyadh
    { lat: 24.9437, lng: 46.9900 },  // Al Janadriyah
    { lat: 24.9651, lng: 46.9051 },  // Thumamah Desert
    { lat: 24.5438, lng: 46.6401 },  // Al Kharj
    { lat: 24.5520, lng: 46.7470 },  // Hotat Bani Tamim
    { lat: 24.7400, lng: 46.9900 },  // Dirab Farms
    { lat: 24.7123, lng: 46.9600 },  // East Outskirts
];



        function initMap() {
            const riyadhLocation = { lat: 24.7136, lng: 46.6753 }; 
            map = new google.maps.Map(document.createElement('div'), {
                center: riyadhLocation,
                zoom: 12
            });
            placesService = new google.maps.places.PlacesService(map);
            fetchPlaces();
        }

        function fetchPlaces() {
            const types = ['restaurant', 'cafe', 'park', 'hotel' ];

            riyadhLocations.forEach(location => {
                types.forEach(type => {
                    let request = {
                        location: location,
                        radius: '5000', // Maximum radius is 50km
                        type: type
                    };
                    fetchNearbyPlaces(request, type);
                });
            });
        }

        function fetchNearbyPlaces(request, type) {
            placesService.nearbySearch(request, (results, status, pagination) => handleResults(results, status, pagination, type));
        }

        function handleResults(results, status, pagination, type) {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                results.forEach(place => {
                    const placeData = {
                        place_id: place.place_id,
                        name: place.name,
                        type: type,  
                        rating: place.rating || 'N/A',
                        lat: place.geometry.location.lat(),
                        lng: place.geometry.location.lng(),
                    };
                    dataset.push(placeData);
                });

                totalFetchedPlaces += results.length;

                if (totalFetchedPlaces < 5000 && pagination && pagination.hasNextPage) {
                    pagination.nextPage();
                } else {
                    console.log("Total places fetched:", dataset.length);
                    downloadDataset(dataset);
                }
            } else {
                console.log("Error fetching places:", status);
            }
        }

        function downloadDataset(data) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'riyadh_places_dataset.json';
            link.click();
        }
    </script>
</body>
</html>
